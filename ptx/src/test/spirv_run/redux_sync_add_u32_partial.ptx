.version 7.0
.target sm_80
.address_size 64

.visible .entry redux_sync_add_u32_partial(
    .param .u64 output
)
{
    .reg .u32             tid;
    .reg .u32             result;
    .reg .u64             out_ptr;

    .reg .u32             tid_rem_2;
    .reg .pred            p;

    ld.param.u64          out_ptr, [output];
    mov.u32               tid, %tid.x;

    rem.u32               tid_rem_2, tid, 2;
    setp.eq.u32           p, tid_rem_2, 0;

    mov.u32               result, 0;
    @p redux.sync.add.u32 result, tid, 0x55555555;
    
    .reg .u64             out_offset;
    mul.wide.u32          out_offset, tid, 4;
    add.u64               out_ptr, out_ptr, out_offset;
    st.u32                [out_ptr], result;

    ret;
}
