
.version 8.3
.target sm_80
.address_size 64

.visible .entry uint_to_fp_bf16(
	.param .u64 input,
	.param .u64 output
)
{
	.reg .u64 	        in_addr;
    .reg .u64 	        out_addr;
    .reg .b16 	        result;
    .reg .pred 	        check;
    .reg .u16 	        check_u16;
    .reg .u32 	        check_u32;
    .reg .f32 	        check_f32;
    .reg .u32           value;
    .reg .u32           dispatch;
    .reg .pred 	        is_jump;

	ld.param.u64 	    in_addr, [input];
    ld.param.u64 	    out_addr, [output];

    ld.u32              value, [in_addr];
    setp.eq.b32         check, value, 1;

    
    ld.u32              dispatch, [in_addr+4];
    setp.eq.u32         is_jump, dispatch, 2;
    @is_jump bra U32;
    setp.eq.u32         is_jump, dispatch, 3;
    @is_jump bra BF16;
    bra END;

U32:
    selp.u32            check_u32, 1, 0, check;
    st.global.u32       [out_addr], check_u32;
    bra.uni END;

BF16:
    selp.u32            check_u32, 1, 0, check;
    cvt.rn.f32.u32      check_f32, check_u32;
    cvt.rn.bf16.f32     result, check_f32;
    st.global.u16       [out_addr], result;

END:
	ret;
}