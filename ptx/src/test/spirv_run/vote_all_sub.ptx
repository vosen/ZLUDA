.version 7.0
.target sm_70
.address_size 64

.visible .entry vote_all_sub(
    .param .u64 output
)
{
    .reg .u32   laneid;
    .reg .u32   tid;
    .reg .pred  first_lane;
    .reg .pred  result_pred;
    .reg .u32   result;
    .reg .u64   out_ptr;

    ld.param.u64    out_ptr, [output];

    mov.u32         laneid, %laneid;
    mov.u32         tid, %tid.x;
    setp.eq.u32     first_lane, laneid, 0;

    mov.pred        result_pred, 0;

    @first_lane bra EXIT;
    // IMPORTANT: it is legal for membermask to be bigger than the execution mask
    vote.sync.all.pred result_pred, 1,  0xFFFFFFFF;
EXIT:
    selp.u32        result, 1, 0, result_pred;

    .reg .u64       out_offset;
    mul.wide.u32    out_offset, tid, 4;
    add.u64         out_ptr, out_ptr, out_offset;
    st.u32 [out_ptr], result;
    ret;
}
